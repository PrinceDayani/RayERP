const mongoose = require('mongoose');\nrequire('dotenv').config();\n\n// Import models\nconst { ChartOfAccounts } = require('../src/models/ChartOfAccounts');\nconst { FiscalYear } = require('../src/models/FiscalYear');\n\n// Chart of Accounts for Infrastructure Projects\nconst chartOfAccounts = [\n  // ASSETS\n  {\n    code: '1000',\n    name: 'ASSETS',\n    type: 'asset',\n    subType: 'Control Account',\n    level: 0,\n    isControlAccount: true,\n    isActive: true\n  },\n  {\n    code: '1100',\n    name: 'Current Assets',\n    type: 'asset',\n    subType: 'Current Assets',\n    level: 1,\n    isControlAccount: true,\n    isActive: true\n  },\n  {\n    code: '1110',\n    name: 'Cash and Bank',\n    type: 'asset',\n    subType: 'Cash',\n    level: 2,\n    isActive: true\n  },\n  {\n    code: '1111',\n    name: 'Cash in Hand',\n    type: 'asset',\n    subType: 'Cash',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '1112',\n    name: 'Bank Account - SBI',\n    type: 'asset',\n    subType: 'Bank',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '1113',\n    name: 'Bank Account - HDFC',\n    type: 'asset',\n    subType: 'Bank',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '1120',\n    name: 'Accounts Receivable',\n    type: 'asset',\n    subType: 'Accounts Receivable',\n    level: 2,\n    isActive: true\n  },\n  {\n    code: '1121',\n    name: 'Trade Receivables',\n    type: 'asset',\n    subType: 'Accounts Receivable',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '1122',\n    name: 'Retention Receivables',\n    type: 'asset',\n    subType: 'Accounts Receivable',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '1130',\n    name: 'Inventory',\n    type: 'asset',\n    subType: 'Inventory',\n    level: 2,\n    isActive: true\n  },\n  {\n    code: '1131',\n    name: 'Raw Materials',\n    type: 'asset',\n    subType: 'Inventory',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '1132',\n    name: 'Work in Progress',\n    type: 'asset',\n    subType: 'Work in Progress',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '1200',\n    name: 'Fixed Assets',\n    type: 'asset',\n    subType: 'Fixed Assets',\n    level: 1,\n    isControlAccount: true,\n    isActive: true\n  },\n  {\n    code: '1210',\n    name: 'Land',\n    type: 'asset',\n    subType: 'Fixed Assets',\n    level: 2,\n    isActive: true\n  },\n  {\n    code: '1220',\n    name: 'Buildings',\n    type: 'asset',\n    subType: 'Fixed Assets',\n    level: 2,\n    isActive: true\n  },\n  {\n    code: '1230',\n    name: 'Machinery and Equipment',\n    type: 'asset',\n    subType: 'Fixed Assets',\n    level: 2,\n    isActive: true\n  },\n  {\n    code: '1240',\n    name: 'Vehicles',\n    type: 'asset',\n    subType: 'Fixed Assets',\n    level: 2,\n    isActive: true\n  },\n  {\n    code: '1250',\n    name: 'Accumulated Depreciation',\n    type: 'asset',\n    subType: 'Accumulated Depreciation',\n    level: 2,\n    isActive: true\n  },\n\n  // LIABILITIES\n  {\n    code: '2000',\n    name: 'LIABILITIES',\n    type: 'liability',\n    subType: 'Control Account',\n    level: 0,\n    isControlAccount: true,\n    isActive: true\n  },\n  {\n    code: '2100',\n    name: 'Current Liabilities',\n    type: 'liability',\n    subType: 'Current Liabilities',\n    level: 1,\n    isControlAccount: true,\n    isActive: true\n  },\n  {\n    code: '2110',\n    name: 'Accounts Payable',\n    type: 'liability',\n    subType: 'Accounts Payable',\n    level: 2,\n    isActive: true\n  },\n  {\n    code: '2111',\n    name: 'Trade Payables',\n    type: 'liability',\n    subType: 'Accounts Payable',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '2112',\n    name: 'Retention Payables',\n    type: 'liability',\n    subType: 'Accounts Payable',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '2120',\n    name: 'Accrued Expenses',\n    type: 'liability',\n    subType: 'Accrued Expenses',\n    level: 2,\n    isActive: true\n  },\n  {\n    code: '2121',\n    name: 'Salary Payable',\n    type: 'liability',\n    subType: 'Salary Payable',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '2122',\n    name: 'Deductions Payable',\n    type: 'liability',\n    subType: 'Deductions Payable',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '2130',\n    name: 'Tax Liabilities',\n    type: 'liability',\n    subType: 'Tax Liabilities',\n    level: 2,\n    isActive: true\n  },\n  {\n    code: '2131',\n    name: 'GST Payable',\n    type: 'liability',\n    subType: 'GST Payable',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '2132',\n    name: 'TDS Payable',\n    type: 'liability',\n    subType: 'TDS Payable',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '2200',\n    name: 'Long-term Liabilities',\n    type: 'liability',\n    subType: 'Long-term Liabilities',\n    level: 1,\n    isControlAccount: true,\n    isActive: true\n  },\n  {\n    code: '2210',\n    name: 'Bank Loans',\n    type: 'liability',\n    subType: 'Bank Loans',\n    level: 2,\n    isActive: true\n  },\n  {\n    code: '2220',\n    name: 'Equipment Loans',\n    type: 'liability',\n    subType: 'Equipment Loans',\n    level: 2,\n    isActive: true\n  },\n\n  // EQUITY\n  {\n    code: '3000',\n    name: 'EQUITY',\n    type: 'equity',\n    subType: 'Control Account',\n    level: 0,\n    isControlAccount: true,\n    isActive: true\n  },\n  {\n    code: '3100',\n    name: 'Share Capital',\n    type: 'equity',\n    subType: 'Share Capital',\n    level: 1,\n    isActive: true\n  },\n  {\n    code: '3200',\n    name: 'Retained Earnings',\n    type: 'equity',\n    subType: 'Retained Earnings',\n    level: 1,\n    isActive: true\n  },\n  {\n    code: '3300',\n    name: 'Current Year Earnings',\n    type: 'equity',\n    subType: 'Current Year Earnings',\n    level: 1,\n    isActive: true\n  },\n\n  // INCOME\n  {\n    code: '4000',\n    name: 'INCOME',\n    type: 'income',\n    subType: 'Control Account',\n    level: 0,\n    isControlAccount: true,\n    isActive: true\n  },\n  {\n    code: '4100',\n    name: 'Operating Revenue',\n    type: 'income',\n    subType: 'Operating Revenue',\n    level: 1,\n    isControlAccount: true,\n    isActive: true\n  },\n  {\n    code: '4110',\n    name: 'Contract Revenue',\n    type: 'income',\n    subType: 'Contract Revenue',\n    level: 2,\n    isActive: true\n  },\n  {\n    code: '4111',\n    name: 'Civil Construction Revenue',\n    type: 'income',\n    subType: 'Contract Revenue',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '4112',\n    name: 'Electrical Work Revenue',\n    type: 'income',\n    subType: 'Contract Revenue',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '4113',\n    name: 'Mechanical Work Revenue',\n    type: 'income',\n    subType: 'Contract Revenue',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '4120',\n    name: 'Rental Income',\n    type: 'income',\n    subType: 'Rental Income',\n    level: 2,\n    isActive: true\n  },\n  {\n    code: '4200',\n    name: 'Other Income',\n    type: 'income',\n    subType: 'Other Income',\n    level: 1,\n    isActive: true\n  },\n\n  // EXPENSES\n  {\n    code: '5000',\n    name: 'EXPENSES',\n    type: 'expense',\n    subType: 'Control Account',\n    level: 0,\n    isControlAccount: true,\n    isActive: true\n  },\n  {\n    code: '5100',\n    name: 'Direct Costs',\n    type: 'expense',\n    subType: 'Direct Costs',\n    level: 1,\n    isControlAccount: true,\n    isActive: true\n  },\n  {\n    code: '5110',\n    name: 'Material Costs',\n    type: 'expense',\n    subType: 'material',\n    level: 2,\n    isActive: true\n  },\n  {\n    code: '5111',\n    name: 'Cement',\n    type: 'expense',\n    subType: 'material',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '5112',\n    name: 'Steel',\n    type: 'expense',\n    subType: 'material',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '5113',\n    name: 'Sand and Aggregates',\n    type: 'expense',\n    subType: 'material',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '5114',\n    name: 'Electrical Materials',\n    type: 'expense',\n    subType: 'material',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '5120',\n    name: 'Labour Costs',\n    type: 'expense',\n    subType: 'labour',\n    level: 2,\n    isActive: true\n  },\n  {\n    code: '5121',\n    name: 'Skilled Labour',\n    type: 'expense',\n    subType: 'labour',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '5122',\n    name: 'Unskilled Labour',\n    type: 'expense',\n    subType: 'labour',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '5123',\n    name: 'Salary',\n    type: 'expense',\n    subType: 'Salary',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '5130',\n    name: 'Equipment Costs',\n    type: 'expense',\n    subType: 'equipment',\n    level: 2,\n    isActive: true\n  },\n  {\n    code: '5131',\n    name: 'Equipment Rental',\n    type: 'expense',\n    subType: 'equipment',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '5132',\n    name: 'Equipment Maintenance',\n    type: 'expense',\n    subType: 'equipment',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '5140',\n    name: 'Subcontractor Costs',\n    type: 'expense',\n    subType: 'subcontractor',\n    level: 2,\n    isActive: true\n  },\n  {\n    code: '5141',\n    name: 'Civil Subcontractor',\n    type: 'expense',\n    subType: 'subcontractor',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '5142',\n    name: 'Electrical Subcontractor',\n    type: 'expense',\n    subType: 'subcontractor',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '5200',\n    name: 'Indirect Costs',\n    type: 'expense',\n    subType: 'overhead',\n    level: 1,\n    isControlAccount: true,\n    isActive: true\n  },\n  {\n    code: '5210',\n    name: 'Site Expenses',\n    type: 'expense',\n    subType: 'overhead',\n    level: 2,\n    isActive: true\n  },\n  {\n    code: '5211',\n    name: 'Site Office Rent',\n    type: 'expense',\n    subType: 'overhead',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '5212',\n    name: 'Utilities',\n    type: 'expense',\n    subType: 'overhead',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '5213',\n    name: 'Security',\n    type: 'expense',\n    subType: 'overhead',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '5220',\n    name: 'Administrative Expenses',\n    type: 'expense',\n    subType: 'overhead',\n    level: 2,\n    isActive: true\n  },\n  {\n    code: '5221',\n    name: 'Office Supplies',\n    type: 'expense',\n    subType: 'overhead',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '5222',\n    name: 'Communication',\n    type: 'expense',\n    subType: 'overhead',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '5230',\n    name: 'Financial Expenses',\n    type: 'expense',\n    subType: 'overhead',\n    level: 2,\n    isActive: true\n  },\n  {\n    code: '5231',\n    name: 'Interest Expense',\n    type: 'expense',\n    subType: 'overhead',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '5232',\n    name: 'Bank Charges',\n    type: 'expense',\n    subType: 'overhead',\n    level: 3,\n    isActive: true\n  },\n  {\n    code: '5240',\n    name: 'Depreciation',\n    type: 'expense',\n    subType: 'Depreciation',\n    level: 2,\n    isActive: true\n  }\n];\n\n// Fiscal Year setup\nconst fiscalYears = [\n  {\n    year: '2024-25',\n    startDate: new Date('2024-04-01'),\n    endDate: new Date('2025-03-31'),\n    isActive: true,\n    isClosed: false,\n    closingRules: {\n      carryForwardBalances: true,\n      autoCloseRevenue: true,\n      autoCloseExpense: true\n    }\n  },\n  {\n    year: '2025-26',\n    startDate: new Date('2025-04-01'),\n    endDate: new Date('2026-03-31'),\n    isActive: false,\n    isClosed: false,\n    closingRules: {\n      carryForwardBalances: true,\n      autoCloseRevenue: true,\n      autoCloseExpense: true\n    }\n  }\n];\n\nasync function seedGLAccounts() {\n  try {\n    // Connect to MongoDB\n    await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/rayerp');\n    console.log('Connected to MongoDB');\n\n    // Clear existing data\n    await ChartOfAccounts.deleteMany({});\n    await FiscalYear.deleteMany({});\n    console.log('Cleared existing GL data');\n\n    // Create parent-child relationships\n    const accountMap = new Map();\n    \n    // First pass: Create all accounts without parent references\n    for (const accountData of chartOfAccounts) {\n      const account = new ChartOfAccounts(accountData);\n      await account.save();\n      accountMap.set(accountData.code, account._id);\n      console.log(`Created account: ${accountData.code} - ${accountData.name}`);\n    }\n\n    // Second pass: Set parent relationships\n    for (const accountData of chartOfAccounts) {\n      if (accountData.level > 0) {\n        // Find parent by looking for account with same prefix but one level up\n        const parentCode = accountData.code.substring(0, accountData.code.length - 1);\n        const parentAccount = chartOfAccounts.find(acc => \n          acc.code === parentCode || \n          (acc.level === accountData.level - 1 && accountData.code.startsWith(acc.code))\n        );\n        \n        if (parentAccount) {\n          await ChartOfAccounts.findOneAndUpdate(\n            { code: accountData.code },\n            { parentId: accountMap.get(parentAccount.code) }\n          );\n          console.log(`Set parent for ${accountData.code}: ${parentAccount.code}`);\n        }\n      }\n    }\n\n    // Create fiscal years\n    for (const fyData of fiscalYears) {\n      const fiscalYear = new FiscalYear(fyData);\n      await fiscalYear.save();\n      console.log(`Created fiscal year: ${fyData.year}`);\n    }\n\n    console.log('\\n‚úÖ GL Accounts and Fiscal Years seeded successfully!');\n    console.log(`üìä Created ${chartOfAccounts.length} accounts`);\n    console.log(`üìÖ Created ${fiscalYears.length} fiscal years`);\n    \n  } catch (error) {\n    console.error('‚ùå Error seeding GL accounts:', error);\n  } finally {\n    await mongoose.disconnect();\n    console.log('Disconnected from MongoDB');\n  }\n}\n\n// Run the seed function\nif (require.main === module) {\n  seedGLAccounts();\n}\n\nmodule.exports = { seedGLAccounts };