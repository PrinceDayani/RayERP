import express from 'express';
import { authenticateToken } from '../middleware/auth.middleware';
import { requireFinanceAccess } from '../middleware/financePermission.middleware';
import {
  createPayment,
  getPayments,
  getPaymentById,
  updatePayment,
  deletePayment,
  updatePaymentStatus,
  approvePayment,
  processRefund,
  raiseDispute,
  reconcilePayment,
  createJournalEntry,
  getPaymentAnalytics,
  batchPayments,
  sendReminder,
  reversePayment,
  getPaymentAging,
  detectDuplicates,
  getCashFlow
} from '../controllers/paymentController';

const router = express.Router();

router.use(authenticateToken);

router.post('/', requireFinanceAccess('payments.create'), createPayment);
router.post('/batch', requireFinanceAccess('payments.create'), batchPayments);
router.get('/', requireFinanceAccess('payments.view'), getPayments);
router.get('/analytics', requireFinanceAccess('payments.view'), getPaymentAnalytics);
router.get('/aging', requireFinanceAccess('payments.view'), getPaymentAging);
router.get('/duplicates', requireFinanceAccess('payments.view'), detectDuplicates);
router.get('/cash-flow', requireFinanceAccess('payments.view'), getCashFlow);
router.get('/:id', requireFinanceAccess('payments.view'), getPaymentById);
router.put('/:id', requireFinanceAccess('payments.edit'), updatePayment);
router.delete('/:id', requireFinanceAccess('payments.delete'), deletePayment);
router.put('/:id/status', requireFinanceAccess('payments.edit'), updatePaymentStatus);
router.post('/:id/approve', requireFinanceAccess('payments.approve'), approvePayment);
router.post('/:id/refund', requireFinanceAccess('payments.edit'), processRefund);
router.post('/:id/dispute', requireFinanceAccess('payments.edit'), raiseDispute);
router.post('/:id/reconcile', requireFinanceAccess('payments.edit'), reconcilePayment);
router.post('/:id/journal-entry', requireFinanceAccess('payments.create'), createJournalEntry);
router.post('/:id/reminder', requireFinanceAccess('payments.view'), sendReminder);
router.post('/:id/reverse', requireFinanceAccess('payments.edit'), reversePayment);

export default router;